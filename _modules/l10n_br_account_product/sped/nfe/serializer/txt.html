
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="pt_BR">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>l10n_br_account_product.sped.nfe.serializer.txt &#8212; documentação Odoo Brazil 8.0.0.0</title>
    
    <link rel="stylesheet" href="../../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/bootswatch-3.3.6/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/oca.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '8.0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../_static/translations.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Índice" href="../../../../../genindex.html" />
    <link rel="search" title="Buscar" href="../../../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../../index.html"><span><img src="../../../../../_static/brazil.png"></span>
          Odoo Brazil</a>
        <span class="navbar-text navbar-version pull-left"><b>8.0.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Código fonte para l10n_br_account_product.sped.nfe.serializer.txt</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Copyright (C) 2009  Renato Lima - Akretion</span>
<span class="c1"># License AGPL-3 - See http://www.gnu.org/licenses/agpl-3.0.html</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">unicodedata</span> <span class="k">import</span> <span class="n">normalize</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">from</span> <span class="nn">openerp</span> <span class="k">import</span> <span class="n">SUPERUSER_ID</span>
<span class="kn">from</span> <span class="nn">openerp</span> <span class="k">import</span> <span class="n">pooler</span>
<span class="kn">from</span> <span class="nn">openerp.addons.l10n_br_base.tools.misc</span> <span class="k">import</span> <span class="n">punctuation_rm</span>


<div class="viewcode-block" id="nfe_export"><a class="viewcode-back" href="../../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.serializer.html#l10n_br_account_product.sped.nfe.serializer.txt.nfe_export">[documentos]</a><span class="k">def</span> <span class="nf">nfe_export</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
               <span class="n">nfe_version</span><span class="o">=</span><span class="s1">&#39;2.00&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># StrFile = &#39;&#39;</span>

    <span class="n">StrNF</span> <span class="o">=</span> <span class="s1">&#39;NOTA FISCAL|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
    <span class="n">StrFile</span> <span class="o">=</span> <span class="n">StrNF</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">pooler</span><span class="o">.</span><span class="n">get_pool</span><span class="p">(</span><span class="n">cr</span><span class="o">.</span><span class="n">dbname</span><span class="p">)</span>

    <span class="n">nfes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">inv</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;account.invoice&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span>
            <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;pt_BR&#39;</span><span class="p">}):</span>
        <span class="c1"># Endereço do company</span>
        <span class="n">company_addr</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">address_get</span><span class="p">(</span>
            <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="p">[</span><span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
        <span class="n">company_addr_default</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span>
            <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="p">[</span><span class="n">company_addr</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]],</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;pt_BR&#39;</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">StrA</span> <span class="o">=</span> <span class="s1">&#39;A|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nfe_version</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrA</span>

        <span class="n">StrRegB</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cUF&#39;</span><span class="p">:</span> <span class="n">company_addr_default</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
            <span class="s1">&#39;cNF&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NatOp&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                                <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">cfop_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">small_name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                      <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;indPag&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">payment_term</span> <span class="ow">and</span> <span class="n">inv</span><span class="o">.</span><span class="n">payment_term</span><span class="o">.</span><span class="n">indPag</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
            <span class="s1">&#39;serie&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">document_serie_id</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
            <span class="s1">&#39;nNF&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">internal_number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hSaiEnt&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tpNF&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cMunFG&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">company_addr_default</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                                  <span class="p">(</span><span class="n">company_addr_default</span>
                                   <span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)),</span>
            <span class="s1">&#39;TpImp&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;TpEmis&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cDV&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tpAmb&#39;</span><span class="p">:</span> <span class="n">nfe_environment</span><span class="p">,</span>
            <span class="s1">&#39;finNFe&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">nfe_purpose</span><span class="p">,</span>
            <span class="s1">&#39;procEmi&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
            <span class="c1"># &#39;VerProc&#39;: &#39;2.2.26&#39;,</span>
            <span class="s1">&#39;dhCont&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xJust&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">cfop_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">):</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;tpNF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;tpNF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>

        <span class="k">if</span> <span class="n">nfe_version</span> <span class="o">==</span> <span class="s1">&#39;3.10&#39;</span><span class="p">:</span>

            <span class="c1"># Capturar a timezone do usuario</span>
            <span class="n">user_pool</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">user_pool</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">SUPERUSER_ID</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
            <span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span>

            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dhEmi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">date_hour_invoice</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dhSaiEnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">date_in_out</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;idDest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">fiscal_position</span><span class="o">.</span><span class="n">cfop_id</span><span class="o">.</span><span class="n">id_dest</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;indFinal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">ind_final</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;indPres&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">ind_pres</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;VerProc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;3.10.18&#39;</span>

            <span class="c1"># Modificado</span>
            <span class="n">StrB</span> <span class="o">=</span> <span class="s1">&#39;B|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="se">\</span>
<span class="s1">            |</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;cUF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;cNF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;NatOp&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;indPag&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;serie&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;nNF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;dhEmi&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dhSaiEnt&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;hSaiEnt&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;tpNF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;idDest&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;cMunFG&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;TpImp&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;TpEmis&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;cDV&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;tpAmb&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;finNFe&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;indFinal&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;indPres&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;procEmi&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;VerProc&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dhCont&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;xJust&#39;</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dEmi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">date_invoice</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dSaiEnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">date_in_out</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;VerProc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2.2.26&#39;</span>

            <span class="n">StrB</span> <span class="o">=</span> <span class="s1">&#39;B|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="se">\</span>
<span class="s1">            |</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;cUF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;cNF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;NatOp&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;indPag&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;serie&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;nNF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dEmi&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dSaiEnt&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;hSaiEnt&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;tpNF&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;cMunFG&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;TpImp&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;TpEmis&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;cDV&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;tpAmb&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span>
                    <span class="s1">&#39;finNFe&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;procEmi&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;VerProc&#39;</span><span class="p">],</span>
                <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;dhCont&#39;</span><span class="p">],</span> <span class="n">StrRegB</span><span class="p">[</span><span class="s1">&#39;xJust&#39;</span><span class="p">])</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrB</span>

        <span class="k">for</span> <span class="n">inv_related</span> <span class="ow">in</span> <span class="n">inv</span><span class="o">.</span><span class="n">fiscal_document_related_ids</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;nf&#39;</span><span class="p">:</span>
                <span class="n">StrRegB14</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;cUF&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span> <span class="ow">and</span>
                    <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;AAMM&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                        <span class="n">inv_related</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;CNPJ&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv_related</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">),</span>
                    <span class="s1">&#39;Mod&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span> <span class="ow">and</span>
                    <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;serie&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">serie</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;nNF&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv_related</span><span class="o">.</span><span class="n">internal_number</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrB14</span> <span class="o">=</span> <span class="s1">&#39;B14|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegB14</span><span class="p">[</span><span class="s1">&#39;cUF&#39;</span><span class="p">],</span>
                                                       <span class="n">StrRegB14</span><span class="p">[</span><span class="s1">&#39;AAMM&#39;</span><span class="p">],</span>
                                                       <span class="n">StrRegB14</span><span class="p">[</span><span class="s1">&#39;CNPJ&#39;</span><span class="p">],</span>
                                                       <span class="n">StrRegB14</span><span class="p">[</span><span class="s1">&#39;CNPJ&#39;</span><span class="p">],</span>
                                                       <span class="n">StrRegB14</span><span class="p">[</span><span class="s1">&#39;serie&#39;</span><span class="p">],</span>
                                                       <span class="n">StrRegB14</span><span class="p">[</span><span class="s1">&#39;nNF&#39;</span><span class="p">])</span>

                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrB14</span>

            <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;nfrural&#39;</span><span class="p">:</span>
                <span class="n">StrRegB20a</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;cUF&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span> <span class="ow">and</span>
                    <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;AAMM&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                        <span class="n">inv_related</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;IE&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv_related</span><span class="o">.</span><span class="n">inscr_est</span><span class="p">),</span>
                    <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span> <span class="ow">and</span>
                    <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;serie&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">serie</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;nNF&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv_related</span><span class="o">.</span><span class="n">internal_number</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="n">StrB20a</span> <span class="o">=</span> <span class="s1">&#39;B20a|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegB20a</span><span class="p">[</span><span class="s1">&#39;cUF&#39;</span><span class="p">],</span>
                                                         <span class="n">StrRegB20a</span><span class="p">[</span><span class="s1">&#39;AAMM&#39;</span><span class="p">],</span>
                                                         <span class="n">StrRegB20a</span><span class="p">[</span><span class="s1">&#39;IE&#39;</span><span class="p">],</span>
                                                         <span class="n">StrRegB20a</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">],</span>
                                                         <span class="n">StrRegB20a</span><span class="p">[</span><span class="s1">&#39;serie&#39;</span><span class="p">],</span>
                                                         <span class="n">StrRegB20a</span><span class="p">[</span><span class="s1">&#39;nNF&#39;</span><span class="p">])</span>

                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrB20a</span>

                <span class="k">if</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">cpfcnpj_type</span> <span class="o">==</span> <span class="s1">&#39;cnpj&#39;</span><span class="p">:</span>
                    <span class="n">StrRegB20d</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;CNPJ&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv_related</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="n">StrB20d</span> <span class="o">=</span> <span class="s1">&#39;B20d|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">StrRegB20d</span><span class="p">[</span><span class="s1">&#39;CNPJ&#39;</span><span class="p">]</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrB20d</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">StrRegB20e</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;CPF&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv_related</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="n">StrB20e</span> <span class="o">=</span> <span class="s1">&#39;B20e|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">StrRegB20e</span><span class="p">[</span><span class="s1">&#39;CPF&#39;</span><span class="p">]</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrB20e</span>
            <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;nfe&#39;</span><span class="p">:</span>
                <span class="n">StrRegBA02</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;refNFe&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">access_key</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">StrBA02</span> <span class="o">=</span> <span class="s1">&#39;BA02|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">StrRegBA02</span><span class="p">[</span><span class="s1">&#39;refNFe&#39;</span><span class="p">]</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrBA02</span>
            <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;cte&#39;</span><span class="p">:</span>
                <span class="n">StrRegB20i</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;refCTe&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">access_key</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">StrB20i</span> <span class="o">=</span> <span class="s1">&#39;B20i|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">StrRegB20i</span><span class="p">[</span><span class="s1">&#39;refCTe&#39;</span><span class="p">]</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrB20i</span>
            <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;cf&#39;</span><span class="p">:</span>
                <span class="n">StrRegB20j</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span> <span class="ow">and</span>
                    <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;nECF&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">internal_number</span><span class="p">,</span>
                    <span class="s1">&#39;nCOO&#39;</span><span class="p">:</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">serie</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">StrB20j</span> <span class="o">=</span> <span class="s1">&#39;B20j|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegB20j</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">],</span> <span class="n">StrRegB20j</span><span class="p">[</span>
                                                <span class="s1">&#39;nECF&#39;</span><span class="p">],</span> <span class="n">StrRegB20j</span><span class="p">[</span><span class="s1">&#39;nCOO&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrB20j</span>

        <span class="n">StrRegC</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;XNome&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">legal_name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;XFant&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;IE&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_est</span><span class="p">),</span>
            <span class="s1">&#39;IEST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;IM&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_mun</span><span class="p">),</span>
            <span class="s1">&#39;CNAE&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">cnae_main_id</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
            <span class="s1">&#39;CRT&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">fiscal_type</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">}</span>

        <span class="c1"># TODO - Verificar, pois quando e informado do CNAE ele exige que a</span>
        <span class="c1"># inscricao municipal, parece um bug do emissor da NFE</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_mun</span><span class="p">:</span>
            <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;CNAE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">StrC</span> <span class="o">=</span> <span class="s1">&#39;C|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;XNome&#39;</span><span class="p">],</span>
                                              <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;XFant&#39;</span><span class="p">],</span>
                                              <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;IE&#39;</span><span class="p">],</span>
                                              <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;IEST&#39;</span><span class="p">],</span>
                                              <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;IM&#39;</span><span class="p">],</span>
                                              <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;CNAE&#39;</span><span class="p">],</span>
                                              <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;CRT&#39;</span><span class="p">])</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrC</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
            <span class="n">StrC02</span> <span class="o">=</span> <span class="s1">&#39;C02|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">StrC02</span> <span class="o">=</span> <span class="s1">&#39;C02a|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">))</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrC02</span>

        <span class="n">address_company_bc_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">company_addr_default</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">bc_code</span><span class="p">:</span>
            <span class="n">address_company_bc_code</span> <span class="o">=</span> <span class="p">(</span><span class="n">company_addr_default</span>
                                       <span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">bc_code</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">StrRegC05</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;XLgr&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">company_addr_default</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Nro&#39;</span><span class="p">:</span> <span class="n">company_addr_default</span><span class="o">.</span><span class="n">number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Cpl&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">company_addr_default</span><span class="o">.</span><span class="n">street2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Bairro&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">company_addr_default</span><span class="o">.</span><span class="n">district</span> <span class="ow">or</span> <span class="s1">&#39;Sem Bairro&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CMun&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">company_addr_default</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                              <span class="n">company_addr_default</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">),</span>
            <span class="s1">&#39;XMun&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">company_addr_default</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;UF&#39;</span><span class="p">:</span> <span class="n">company_addr_default</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CEP&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">company_addr_default</span><span class="o">.</span><span class="n">zip</span><span class="p">),</span>
            <span class="s1">&#39;cPais&#39;</span><span class="p">:</span> <span class="n">address_company_bc_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;xPais&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">company_addr_default</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;fone&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">company_addr_default</span><span class="o">.</span><span class="n">phone</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39; &#39;</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">StrC05</span> <span class="o">=</span> <span class="s1">&#39;C05|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;XLgr&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;Nro&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span>
                <span class="s1">&#39;Cpl&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;Bairro&#39;</span><span class="p">],</span>
            <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;CMun&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span>
                <span class="s1">&#39;XMun&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;UF&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;CEP&#39;</span><span class="p">],</span>
            <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;cPais&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;xPais&#39;</span><span class="p">],</span> <span class="n">StrRegC05</span><span class="p">[</span><span class="s1">&#39;fone&#39;</span><span class="p">])</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrC05</span>

        <span class="n">partner_bc_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">address_invoice_state_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">address_invoice_city</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">UFEmbarq</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">XLocEmbarq</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">partner_cep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">bc_code</span><span class="p">:</span>
            <span class="n">partner_bc_code</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">bc_code</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">company_addr_default</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="n">address_invoice_state_code</span> <span class="o">=</span> <span class="s1">&#39;EX&#39;</span>
            <span class="n">address_invoice_city</span> <span class="o">=</span> <span class="s1">&#39;Exterior&#39;</span>
            <span class="n">address_invoice_city_code</span> <span class="o">=</span> <span class="s1">&#39;9999999&#39;</span>
            <span class="n">UFEmbarq</span> <span class="o">=</span> <span class="n">company_addr_default</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span>
            <span class="n">XLocEmbarq</span> <span class="o">=</span> <span class="n">company_addr_default</span><span class="o">.</span><span class="n">city</span>
            <span class="n">partner_cep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">address_invoice_state_code</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span>
            <span class="n">address_invoice_city</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="n">address_invoice_city_code</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)</span>
            <span class="n">partner_cep</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">zip</span><span class="p">)</span>

        <span class="c1"># Se o ambiente for de teste deve ser escrito na razão do destinatário</span>
        <span class="k">if</span> <span class="n">nfe_environment</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
            <span class="n">xNome</span> <span class="o">=</span> <span class="s1">&#39;NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO&#39;</span>\
                    <span class="s1">&#39; - SEM VALOR FISCAL&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xNome</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">legal_name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">StrRegE</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xNome&#39;</span><span class="p">:</span> <span class="n">xNome</span><span class="p">,</span>
            <span class="s1">&#39;IE&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_est</span><span class="p">),</span>
            <span class="s1">&#39;ISUF&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">email</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Adicionado</span>
        <span class="k">if</span> <span class="n">nfe_version</span> <span class="o">==</span> <span class="s1">&#39;3.10&#39;</span><span class="p">:</span>
            <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;indIEDest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">cfop_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id_dest</span>
            <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;IM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">StrRegC</span><span class="p">[</span><span class="s1">&#39;IM&#39;</span><span class="p">]</span>

            <span class="n">StrE</span> <span class="o">=</span> <span class="s1">&#39;E|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;xNome&#39;</span><span class="p">],</span>
                                               <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;indIEDest&#39;</span><span class="p">],</span>
                                               <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;IE&#39;</span><span class="p">],</span>
                                               <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;ISUF&#39;</span><span class="p">],</span>
                                               <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;IM&#39;</span><span class="p">],</span>
                                               <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">StrE</span> <span class="o">=</span> <span class="s1">&#39;E|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;xNome&#39;</span><span class="p">],</span> <span class="n">StrRegE</span><span class="p">[</span>
                <span class="s1">&#39;IE&#39;</span><span class="p">],</span> <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;ISUF&#39;</span><span class="p">],</span> <span class="n">StrRegE</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrE</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
            <span class="n">StrE0</span> <span class="o">=</span> <span class="s1">&#39;E02|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">StrE0</span> <span class="o">=</span> <span class="s1">&#39;E03|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">))</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrE0</span>

        <span class="n">StrRegE05</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xLgr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                     <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;nro&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;xCpl&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">street2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">))),</span>
            <span class="s1">&#39;xBairro&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">district</span> <span class="ow">or</span> <span class="s1">&#39;Sem Bairro&#39;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;cMun&#39;</span><span class="p">:</span> <span class="n">address_invoice_city_code</span><span class="p">,</span>
            <span class="s1">&#39;xMun&#39;</span><span class="p">:</span> <span class="n">address_invoice_city</span><span class="p">,</span>
            <span class="s1">&#39;UF&#39;</span><span class="p">:</span> <span class="n">address_invoice_state_code</span><span class="p">,</span>
            <span class="s1">&#39;CEP&#39;</span><span class="p">:</span> <span class="n">partner_cep</span><span class="p">,</span>
            <span class="s1">&#39;cPais&#39;</span><span class="p">:</span> <span class="n">partner_bc_code</span><span class="p">,</span>
            <span class="s1">&#39;xPais&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
            <span class="c1"># &#39;fone&#39;: re.sub(&#39;[%s]&#39; % re.escape(string.punctuation), &#39;&#39;,</span>
            <span class="c1">#                str(inv.partner_id.phone or &#39;&#39;).replace(&#39; &#39;, &#39;&#39;)),</span>
            <span class="s1">&#39;fone&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">phone</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
        <span class="p">}</span>

        <span class="n">StrE05</span> <span class="o">=</span> <span class="s1">&#39;E05|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;xLgr&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;nro&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span>
                <span class="s1">&#39;xCpl&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;xBairro&#39;</span><span class="p">],</span>
            <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;cMun&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span>
                <span class="s1">&#39;xMun&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;UF&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;CEP&#39;</span><span class="p">],</span>
            <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;cPais&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;xPais&#39;</span><span class="p">],</span> <span class="n">StrRegE05</span><span class="p">[</span><span class="s1">&#39;fone&#39;</span><span class="p">],)</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrE05</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>

                <span class="n">StrRegG</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;XLgr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                        <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;Nro&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                            <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                            <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                            <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;XCpl&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                        <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">street2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">))),</span>
                    <span class="s1">&#39;XBairro&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                        <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">district</span> <span class="ow">or</span>
                                        <span class="s1">&#39;Sem Bairro&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                                                              <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;CMun&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                        <span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">),</span>
                    <span class="s1">&#39;XMun&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                             <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                             <span class="n">unicode</span><span class="p">((</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span>
                                      <span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                             <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;UF&#39;</span><span class="p">:</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
                <span class="p">}</span>

                <span class="n">StrG</span> <span class="o">=</span> <span class="s1">&#39;G|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">StrRegG</span><span class="p">[</span><span class="s1">&#39;XLgr&#39;</span><span class="p">],</span> <span class="n">StrRegG</span><span class="p">[</span><span class="s1">&#39;Nro&#39;</span><span class="p">],</span> <span class="n">StrRegG</span><span class="p">[</span>
                        <span class="s1">&#39;XCpl&#39;</span><span class="p">],</span> <span class="n">StrRegG</span><span class="p">[</span><span class="s1">&#39;XBairro&#39;</span><span class="p">],</span> <span class="n">StrRegG</span><span class="p">[</span><span class="s1">&#39;CMun&#39;</span><span class="p">],</span>
                    <span class="n">StrRegG</span><span class="p">[</span><span class="s1">&#39;XMun&#39;</span><span class="p">],</span>
                    <span class="n">StrRegG</span><span class="p">[</span><span class="s1">&#39;UF&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrG</span>

                <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
                    <span class="c1"># StrG0 = &#39;G02|%s|\n&#39; % (</span>
                    <span class="c1"># re.sub(&#39;[%s]&#39; % re.escape(string.punctuation), &#39;&#39;,</span>
                    <span class="c1"># inv.partner_id.cnpj_cpf or &#39;&#39;))</span>
                    <span class="n">StrG0</span> <span class="o">=</span> <span class="s1">&#39;G02|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># StrG0 = &#39;G02a|%s|\n&#39; % (</span>
                    <span class="c1"># re.sub(&#39;[%s]&#39; % re.escape(string.punctuation), &#39;&#39;,</span>
                    <span class="c1"># inv.partner_id.cnpj_cpf or &#39;&#39;))</span>
                    <span class="n">StrG0</span> <span class="o">=</span> <span class="s1">&#39;G02a|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>

                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrG0</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">inv_line</span> <span class="ow">in</span> <span class="n">inv</span><span class="o">.</span><span class="n">invoice_line</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># FIXME</span>
            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">freight_value</span><span class="p">:</span>
                <span class="n">freight_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">freight_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">freight_value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">insurance_value</span><span class="p">:</span>
                <span class="n">insurance_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">insurance_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">insurance_value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">other_costs_value</span><span class="p">:</span>
                <span class="n">other_costs_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">other_costs_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_costs_value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">discount_value</span><span class="p">:</span>
                <span class="n">discount_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">discount_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">discount_value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">StrH</span> <span class="o">=</span> <span class="s1">&#39;H|</span><span class="si">%s</span><span class="s1">||</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrH</span>

            <span class="n">CProd</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">XProd</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">code</span><span class="p">:</span>
                <span class="n">CProd</span> <span class="o">=</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">code</span>
                <span class="n">XProd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CProd</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">u&#39;0&#39;</span><span class="p">)</span>
                <span class="n">XProd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">inv_line</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

            <span class="n">StrRegI</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;CProd&#39;</span><span class="p">:</span> <span class="n">CProd</span><span class="p">,</span>
                <span class="s1">&#39;CEAN&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">ean13</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;XProd&#39;</span><span class="p">:</span> <span class="n">XProd</span><span class="p">,</span>
                <span class="s1">&#39;EXTIPI&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;CFOP&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cfop_id</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
                <span class="s1">&#39;UCom&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                    <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                    <span class="n">unicode</span><span class="p">(</span>
                        <span class="n">inv_line</span><span class="o">.</span><span class="n">uos_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                    <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
                <span class="s1">&#39;QCom&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="n">inv_line</span><span class="o">.</span><span class="n">quantity</span><span class="p">),</span>
                <span class="s1">&#39;VUnCom&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.7f</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="n">inv_line</span><span class="o">.</span><span class="n">price_unit</span><span class="p">),</span>
                <span class="s1">&#39;VProd&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="n">inv_line</span><span class="o">.</span><span class="n">price_gross</span><span class="p">),</span>
                <span class="s1">&#39;CEANTrib&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">ean13</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;UTrib&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                    <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                    <span class="n">unicode</span><span class="p">(</span>
                        <span class="n">inv_line</span><span class="o">.</span><span class="n">uos_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                    <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
                <span class="s1">&#39;QTrib&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="n">inv_line</span><span class="o">.</span><span class="n">quantity</span><span class="p">),</span>
                <span class="s1">&#39;VUnTrib&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.7f</span><span class="s2">&quot;</span> <span class="o">%</span>
                    <span class="n">inv_line</span><span class="o">.</span><span class="n">price_unit</span><span class="p">),</span>
                <span class="s1">&#39;VFrete&#39;</span><span class="p">:</span> <span class="n">freight_value</span><span class="p">,</span>
                <span class="s1">&#39;VSeg&#39;</span><span class="p">:</span> <span class="n">insurance_value</span><span class="p">,</span>
                <span class="s1">&#39;VDesc&#39;</span><span class="p">:</span> <span class="n">discount_value</span><span class="p">,</span>
                <span class="s1">&#39;vOutro&#39;</span><span class="p">:</span> <span class="n">other_costs_value</span><span class="p">,</span>
                <span class="s1">&#39;indTot&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;xPed&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nItemPed&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nFCI&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">fci</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;NCM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">inv_line</span><span class="o">.</span><span class="n">fiscal_classification_id</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nfe_version</span> <span class="o">==</span> <span class="s1">&#39;3.10&#39;</span><span class="p">:</span>

                <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;NVE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;nFCI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="n">StrI</span> <span class="o">=</span> <span class="s1">&#39;I|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">&#39;</span>\
                       <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CProd&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CEAN&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;XProd&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;NCM&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;NVE&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;EXTIPI&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CFOP&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;UCom&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;QCom&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VUnCom&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VProd&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CEANTrib&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;UTrib&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;QTrib&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VUnTrib&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VFrete&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VSeg&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VDesc&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;vOutro&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;indTot&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;xPed&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;nItemPed&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;nFCI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">StrI</span> <span class="o">=</span> <span class="s1">&#39;I|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">&#39;</span>\
                       <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CProd&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CEAN&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;XProd&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;NCM&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;EXTIPI&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CFOP&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;UCom&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;QCom&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VUnCom&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VProd&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;CEANTrib&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;UTrib&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;QTrib&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VUnTrib&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VFrete&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VSeg&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;VDesc&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;vOutro&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;indTot&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;xPed&#39;</span><span class="p">],</span>
                           <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;nItemPed&#39;</span><span class="p">],</span> <span class="n">StrRegI</span><span class="p">[</span><span class="s1">&#39;nFCI&#39;</span><span class="p">])</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrI</span>

            <span class="k">for</span> <span class="n">inv_di</span> <span class="ow">in</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">import_declaration_ids</span><span class="p">:</span>

                <span class="n">StrRegI18</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;NDI&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;DDI&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">date_registration</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;XLocDesemb&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                    <span class="s1">&#39;UFDesemb&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;DDesemb&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">date_release</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;tpViaTransp&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">type_transportation</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;vAFRMM&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">afrmm_value</span><span class="p">),</span>
                    <span class="s1">&#39;tpIntermedio&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">type_import</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;CNPJ&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">exporting_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;UFTerceiro&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">thirdparty_state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;CExportador&#39;</span><span class="p">:</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">exporting_code</span><span class="p">,</span>
                <span class="p">}</span>

                <span class="n">StrI18</span> <span class="o">=</span> <span class="s1">&#39;I18|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;NDI&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;DDI&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;XLocDesemb&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;UFDesemb&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;DDesemb&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;tpViaTransp&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;vAFRMM&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;tpIntermedio&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;CNPJ&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;UFTerceiro&#39;</span><span class="p">],</span>
                    <span class="n">StrRegI18</span><span class="p">[</span><span class="s1">&#39;CExportador&#39;</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrI18</span>

                <span class="k">for</span> <span class="n">inv_di_line</span> <span class="ow">in</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">line_ids</span><span class="p">:</span>

                    <span class="n">StrRegI25</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;NAdicao&#39;</span><span class="p">:</span> <span class="n">inv_di_line</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s1">&#39;NSeqAdic&#39;</span><span class="p">:</span> <span class="n">inv_di_line</span><span class="o">.</span><span class="n">sequence</span><span class="p">,</span>
                        <span class="s1">&#39;CFabricante&#39;</span><span class="p">:</span> <span class="n">inv_di_line</span><span class="o">.</span><span class="n">manufacturer_code</span><span class="p">,</span>
                        <span class="s1">&#39;VDescDI&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_di_line</span><span class="o">.</span><span class="n">amount_discount</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="n">StrRegI25</span><span class="p">[</span><span class="s1">&#39;VDescDI&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0.00&#39;</span><span class="p">:</span>
                        <span class="n">StrRegI25</span><span class="p">[</span><span class="s1">&#39;VDescDI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                    <span class="n">StrI25</span> <span class="o">=</span> <span class="s1">&#39;I25|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegI25</span><span class="p">[</span><span class="s1">&#39;NAdicao&#39;</span><span class="p">],</span>
                        <span class="n">StrRegI25</span><span class="p">[</span><span class="s1">&#39;NSeqAdic&#39;</span><span class="p">],</span>
                        <span class="n">StrRegI25</span><span class="p">[</span><span class="s1">&#39;CFabricante&#39;</span><span class="p">],</span>
                        <span class="n">StrRegI25</span><span class="p">[</span><span class="s1">&#39;VDescDI&#39;</span><span class="p">],</span>
                    <span class="p">)</span>

                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrI25</span>

            <span class="n">icms_cst</span> <span class="o">=</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_cst_id</span> <span class="ow">and</span>\
                <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_cst_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ipi_cst</span> <span class="o">=</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_cst_id</span> <span class="ow">and</span>\
                <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_cst_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">pis_cst</span> <span class="o">=</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_cst_id</span> <span class="ow">and</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_cst_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">cofins_cst</span> <span class="o">=</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_cst_id</span> <span class="ow">and</span>\
                <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_cst_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

            <span class="n">StrRegStrM</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;vTotTrib&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">total_taxes</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="n">StrM</span> <span class="o">=</span> <span class="s1">&#39;M|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegStrM</span><span class="p">[</span><span class="s1">&#39;vTotTrib&#39;</span><span class="p">])</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrM</span>

            <span class="n">StrN</span> <span class="o">=</span> <span class="s1">&#39;N|</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN</span>

            <span class="c1"># TODO - Fazer alteração para cada tipo de cst ICMS</span>
            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_type</span> <span class="o">==</span> <span class="s1">&#39;product&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;00&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN02</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBC&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN02</span> <span class="o">=</span> <span class="s1">&#39;N02|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegN02</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN02</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegN02</span><span class="p">[</span>
                            <span class="s1">&#39;ModBC&#39;</span><span class="p">],</span> <span class="n">StrRegN02</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegN02</span><span class="p">[</span><span class="s1">&#39;PICMS&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN02</span><span class="p">[</span><span class="s1">&#39;VICMS&#39;</span><span class="p">])</span>

                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN02</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;10&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN03</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBC&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                        <span class="s1">&#39;ModBCST&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PMVAST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_mva</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;VBCST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN03</span> <span class="o">=</span> <span class="s1">&#39;N03|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN03</span><span class="p">[</span>
                            <span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;ModBC&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegN03</span><span class="p">[</span>
                            <span class="s1">&#39;PICMS&#39;</span><span class="p">],</span> <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;VICMS&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;ModBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;PMVAST&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;PRedBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;VBCST&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;PICMSST&#39;</span><span class="p">],</span> <span class="n">StrRegN03</span><span class="p">[</span><span class="s1">&#39;VICMSST&#39;</span><span class="p">])</span>

                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN03</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;20&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN04</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBC&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent_reduction</span><span class="p">),</span>
                        <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN04</span> <span class="o">=</span> <span class="s1">&#39;N04|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegN04</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN04</span><span class="p">[</span>
                            <span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegN04</span><span class="p">[</span><span class="s1">&#39;ModBC&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN04</span><span class="p">[</span><span class="s1">&#39;PRedBC&#39;</span><span class="p">],</span> <span class="n">StrRegN04</span><span class="p">[</span>
                            <span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegN04</span><span class="p">[</span><span class="s1">&#39;PICMS&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN04</span><span class="p">[</span><span class="s1">&#39;VICMS&#39;</span><span class="p">])</span>

                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN04</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;40&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">):</span>
                    <span class="n">StrRegN06</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;vICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                        <span class="s1">&#39;motDesICMS&#39;</span><span class="p">:</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span>  <span class="c1"># FIXME</span>
                    <span class="p">}</span>
                    <span class="n">StrN06</span> <span class="o">=</span> <span class="s1">&#39;N06|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegN06</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN06</span><span class="p">[</span>
                            <span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegN06</span><span class="p">[</span><span class="s1">&#39;vICMS&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN06</span><span class="p">[</span><span class="s1">&#39;motDesICMS&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN06</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;41&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN06</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;vICMS&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;motDesICMS&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">StrN06</span> <span class="o">=</span> <span class="s1">&#39;N06|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegN06</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN06</span><span class="p">[</span>
                            <span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegN06</span><span class="p">[</span><span class="s1">&#39;vICMS&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN06</span><span class="p">[</span><span class="s1">&#39;motDesICMS&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN06</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;51&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN07</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBC&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent_reduction</span><span class="p">),</span>
                        <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                    <span class="p">}</span>
                    <span class="n">StrN07</span> <span class="o">=</span> <span class="s1">&#39;N07|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegN07</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN07</span><span class="p">[</span>
                            <span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegN07</span><span class="p">[</span><span class="s1">&#39;ModBC&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN07</span><span class="p">[</span><span class="s1">&#39;PRedBC&#39;</span><span class="p">],</span> <span class="n">StrRegN07</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span>
                        <span class="n">StrRegN07</span><span class="p">[</span><span class="s1">&#39;PICMS&#39;</span><span class="p">],</span> <span class="n">StrRegN07</span><span class="p">[</span><span class="s1">&#39;VICMS&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN07</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;60&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN08</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;VBCST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                        <span class="s1">&#39;VICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN08</span> <span class="o">=</span> <span class="s1">&#39;N08|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegN08</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span>
                                                     <span class="n">StrRegN08</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span>
                                                     <span class="n">StrRegN08</span><span class="p">[</span><span class="s1">&#39;VBCST&#39;</span><span class="p">],</span>
                                                     <span class="n">StrRegN08</span><span class="p">[</span><span class="s1">&#39;VICMSST&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN08</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;70&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN09</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBC&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent_reduction</span><span class="p">),</span>
                        <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                        <span class="s1">&#39;ModBCST&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PMVAST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_mva</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;VBCST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN09</span> <span class="o">=</span> <span class="s1">&#39;N09|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">&#39;</span>\
                             <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span>
                                 <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;ModBC&#39;</span><span class="p">],</span> <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;PRedBC&#39;</span><span class="p">],</span>
                                 <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;PICMS&#39;</span><span class="p">],</span>
                                 <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;VICMS&#39;</span><span class="p">],</span> <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;ModBCST&#39;</span><span class="p">],</span>
                                 <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;PMVAST&#39;</span><span class="p">],</span> <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;PRedBCST&#39;</span><span class="p">],</span>
                                 <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;VBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;PICMSST&#39;</span><span class="p">],</span>
                                 <span class="n">StrRegN09</span><span class="p">[</span><span class="s1">&#39;VICMSST&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN09</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;90&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN10</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBC&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent_reduction</span><span class="p">),</span>
                        <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                        <span class="s1">&#39;ModBCST&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PMVAST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_mva</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;VBCST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                            <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN10</span> <span class="o">=</span> <span class="s1">&#39;N10|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>\
                        <span class="p">(</span><span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;ModBC&#39;</span><span class="p">],</span> <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;PRedBC&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;PICMS&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;VICMS&#39;</span><span class="p">],</span> <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;ModBCST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;PMVAST&#39;</span><span class="p">],</span> <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;PRedBCST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;VBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;PICMSST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10</span><span class="p">[</span><span class="s1">&#39;VICMSST&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN10</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;101&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN10c</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CSOSN&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;pCredSN&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">),</span>
                        <span class="s1">&#39;vCredICMSSN&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN10c</span> <span class="o">=</span> <span class="s1">&#39;N10c|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>\
                        <span class="p">(</span><span class="n">StrRegN10c</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN10c</span><span class="p">[</span><span class="s1">&#39;CSOSN&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10c</span><span class="p">[</span><span class="s1">&#39;pCredSN&#39;</span><span class="p">],</span> <span class="n">StrRegN10c</span><span class="p">[</span><span class="s1">&#39;vCredICMSSN&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN10c</span>

                <span class="c1"># Incluido CST 102,103 e 300 - Uso no Simples Nacional - Linha</span>
                <span class="c1"># original era para CST 400</span>
                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;102&#39;</span><span class="p">,</span> <span class="s1">&#39;103&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">):</span>
                    <span class="n">StrRegN10d</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CSOSN&#39;</span><span class="p">:</span> <span class="n">icms_cst</span>
                    <span class="p">}</span>

                    <span class="n">StrN10d</span> <span class="o">=</span> <span class="s1">&#39;N10d|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegN10d</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN10d</span><span class="p">[</span><span class="s1">&#39;CSOSN&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN10d</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;201&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN10e</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CSOSN&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBCST&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PMVAST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_mva</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;VBCST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">),</span>
                        <span class="c1"># TODO Obter aliquota ICMS Simples</span>
                        <span class="s1">&#39;pCredSN&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                        <span class="c1"># TODO Calcular Crédito ICMS baseado aliquota anterior.</span>
                        <span class="s1">&#39;vCredICMSSN&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN10e</span> <span class="o">=</span> <span class="s1">&#39;N10e|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>\
                        <span class="p">(</span><span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;CSOSN&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;ModBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;PMVAST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;PRedBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;VBCST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;PICMSST&#39;</span><span class="p">],</span> <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;VICMSST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;pCredSN&#39;</span><span class="p">],</span> <span class="n">StrRegN10e</span><span class="p">[</span><span class="s1">&#39;vCredICMSSN&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN10e</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;202&#39;</span><span class="p">,</span> <span class="s1">&#39;203&#39;</span><span class="p">):</span>
                    <span class="n">StrRegN10f</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CSOSN&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;ModBCST&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;PMVAST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_mva</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;PRedBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;VBCST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">),</span>
                        <span class="s1">&#39;PICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_percent</span><span class="p">),</span>
                        <span class="s1">&#39;VICMSST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN10f</span> <span class="o">=</span> <span class="s1">&#39;N10f|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>\
                        <span class="p">(</span><span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;CSOSN&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;ModBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;PMVAST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;PRedBCST&#39;</span><span class="p">],</span> <span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;VBCST&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;PICMSST&#39;</span><span class="p">],</span> <span class="n">StrRegN10f</span><span class="p">[</span><span class="s1">&#39;VICMSST&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN10f</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;500&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN10g</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CSOSN&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;vBCSTRet&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># TODO Variavel cf Faixa faturamento</span>
                        <span class="s1">&#39;vICMSSTRet&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># TODO Variavel cf Faixa faturamento</span>
                    <span class="p">}</span>

                    <span class="n">StrN10g</span> <span class="o">=</span> <span class="s1">&#39;N10g|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>\
                        <span class="p">(</span><span class="n">StrRegN10g</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span> <span class="n">StrRegN10g</span><span class="p">[</span><span class="s1">&#39;CSOSN&#39;</span><span class="p">],</span>
                         <span class="n">StrRegN10g</span><span class="p">[</span><span class="s1">&#39;vBCSTRet&#39;</span><span class="p">],</span> <span class="n">StrRegN10g</span><span class="p">[</span><span class="s1">&#39;vICMSSTRet&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN10g</span>

                <span class="k">if</span> <span class="n">icms_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;900&#39;</span><span class="p">,):</span>
                    <span class="n">StrRegN10h</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;Orig&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">origin</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;CSOSN&#39;</span><span class="p">:</span> <span class="n">icms_cst</span><span class="p">,</span>
                        <span class="s1">&#39;modBC&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">icms_base_type</span><span class="p">,</span>
                        <span class="s1">&#39;vBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                        <span class="s1">&#39;pRedBC&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                        <span class="s1">&#39;vICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                        <span class="s1">&#39;modBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pMVAST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pRedBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;vBCST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pICMSST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;vICMSST&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;pCredSN&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                        <span class="s1">&#39;vCredICMSSN&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mf">0.00</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrN10h</span> <span class="o">=</span> <span class="s1">&#39;N10h|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">&#39;</span>\
                              <span class="s1">&#39;|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;Orig&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;CSOSN&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;modBC&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;vBC&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;pRedBC&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;pICMS&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;vICMS&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;modBCST&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;pMVAST&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;pRedBCST&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;vBCST&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;pICMSST&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;vICMSST&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;pCredSN&#39;</span><span class="p">],</span>
                                          <span class="n">StrRegN10h</span><span class="p">[</span><span class="s1">&#39;vCredICMSSN&#39;</span><span class="p">])</span>

                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrN10h</span>

                <span class="n">StrRegO</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;ClEnq&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;CNPJProd&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;CSelo&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;QSelo&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;CEnq&#39;</span><span class="p">:</span> <span class="s1">&#39;999&#39;</span><span class="p">,</span>
                <span class="p">}</span>

                <span class="n">StrO</span> <span class="o">=</span> <span class="s1">&#39;O|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegO</span><span class="p">[</span><span class="s1">&#39;ClEnq&#39;</span><span class="p">],</span>
                                                <span class="n">StrRegO</span><span class="p">[</span><span class="s1">&#39;CNPJProd&#39;</span><span class="p">],</span>
                                                <span class="n">StrRegO</span><span class="p">[</span><span class="s1">&#39;CSelo&#39;</span><span class="p">],</span>
                                                <span class="n">StrRegO</span><span class="p">[</span><span class="s1">&#39;QSelo&#39;</span><span class="p">],</span>
                                                <span class="n">StrRegO</span><span class="p">[</span><span class="s1">&#39;CEnq&#39;</span><span class="p">])</span>

                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrO</span>

                <span class="k">if</span> <span class="n">ipi_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;50&#39;</span><span class="p">,</span> <span class="s1">&#39;51&#39;</span><span class="p">,</span> <span class="s1">&#39;52&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_percent</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">StrRegO07</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">ipi_cst</span><span class="p">,</span>
                        <span class="s1">&#39;VIPI&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrO07</span> <span class="o">=</span> <span class="s1">&#39;O07|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegO07</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegO07</span><span class="p">[</span><span class="s1">&#39;VIPI&#39;</span><span class="p">])</span>

                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrO07</span>

                    <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_type</span> <span class="o">==</span> <span class="s1">&#39;percent&#39;</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">StrRegO10</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_base</span><span class="p">),</span>
                            <span class="s1">&#39;PIPI&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_percent</span><span class="p">),</span>
                        <span class="p">}</span>
                        <span class="n">StrO1</span> <span class="o">=</span> <span class="s1">&#39;O10|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">StrRegO10</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegO10</span><span class="p">[</span><span class="s1">&#39;PIPI&#39;</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_type</span> <span class="o">==</span> <span class="s1">&#39;quantity&#39;</span><span class="p">:</span>
                        <span class="n">pesol</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="p">:</span>
                            <span class="n">pesol</span> <span class="o">=</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">weight_net</span>
                        <span class="n">StrRegO11</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;QUnid&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">inv_line</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">pesol</span><span class="p">)),</span>
                            <span class="s1">&#39;VUnid&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_percent</span><span class="p">),</span>
                        <span class="p">}</span>
                        <span class="n">StrO1</span> <span class="o">=</span> <span class="s1">&#39;O11|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">StrRegO11</span><span class="p">[</span><span class="s1">&#39;QUnid&#39;</span><span class="p">],</span> <span class="n">StrRegO11</span><span class="p">[</span><span class="s1">&#39;VUnid&#39;</span><span class="p">])</span>

                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrO1</span>

                <span class="k">if</span> <span class="n">ipi_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;99&#39;</span><span class="p">):</span>
                    <span class="n">StrRegO07</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">ipi_cst</span><span class="p">,</span>
                        <span class="s1">&#39;VIPI&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_value</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrO07</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;O07|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegO07</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegO07</span><span class="p">[</span><span class="s1">&#39;VIPI&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrO07</span>

                    <span class="n">StrRegO10</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_base</span><span class="p">),</span>
                        <span class="s1">&#39;PIPI&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_percent</span><span class="p">),</span>
                    <span class="p">}</span>

                    <span class="n">StrO10</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;O10|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">StrRegO10</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegO10</span><span class="p">[</span><span class="s1">&#39;PIPI&#39;</span><span class="p">])</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrO10</span>

                <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ipi_percent</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ipi_cst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;99&#39;</span><span class="p">):</span>
                    <span class="n">StrO1</span> <span class="o">=</span> <span class="s1">&#39;O08|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ipi_cst</span>
                    <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrO1</span>

                <span class="n">StrRegP</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ii_base</span><span class="p">),</span>
                    <span class="s1">&#39;VDespAdu&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ii_customhouse_charges</span><span class="p">),</span>
                    <span class="s1">&#39;VII&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ii_value</span><span class="p">),</span>
                    <span class="s1">&#39;VIOF&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">ii_iof</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrP</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;P|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegP</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegP</span><span class="p">[</span>
                    <span class="s1">&#39;VDespAdu&#39;</span><span class="p">],</span> <span class="n">StrRegP</span><span class="p">[</span><span class="s1">&#39;VII&#39;</span><span class="p">],</span> <span class="n">StrRegP</span><span class="p">[</span><span class="s1">&#39;VIOF&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrP</span>

            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">product_type</span> <span class="o">==</span> <span class="s1">&#39;service&#39;</span><span class="p">:</span>
                <span class="n">StrRegU</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">issqn_base</span><span class="p">),</span>
                    <span class="s1">&#39;VAliq&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">issqn_percent</span><span class="p">),</span>
                    <span class="s1">&#39;VISSQN&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">issqn_value</span><span class="p">),</span>
                    <span class="s1">&#39;CMunFG&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                                          <span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">partner_id</span>
                                           <span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)),</span>
                    <span class="s1">&#39;CListServ&#39;</span><span class="p">:</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv_line</span><span class="o">.</span><span class="n">service_type_id</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                    <span class="s1">&#39;cSitTrib&#39;</span><span class="p">:</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">issqn_type</span><span class="p">}</span>

                <span class="n">StrU</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;U|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">StrRegU</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span>
                    <span class="n">StrRegU</span><span class="p">[</span><span class="s1">&#39;VAliq&#39;</span><span class="p">],</span>
                    <span class="n">StrRegU</span><span class="p">[</span><span class="s1">&#39;VISSQN&#39;</span><span class="p">],</span>
                    <span class="n">StrRegU</span><span class="p">[</span><span class="s1">&#39;CMunFG&#39;</span><span class="p">],</span>
                    <span class="n">StrRegU</span><span class="p">[</span><span class="s1">&#39;CListServ&#39;</span><span class="p">],</span>
                    <span class="n">StrRegU</span><span class="p">[</span><span class="s1">&#39;cSitTrib&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrU</span>

            <span class="n">StrQ</span> <span class="o">=</span> <span class="s1">&#39;Q|</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrQ</span>

            <span class="k">if</span> <span class="n">pis_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;02&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_percent</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">StrRegQ02</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">pis_cst</span><span class="p">,</span>
                    <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_base</span><span class="p">),</span>
                    <span class="s1">&#39;PPIS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_percent</span><span class="p">),</span>
                    <span class="s1">&#39;VPIS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_value</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrQ02</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Q02|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegQ02</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span>
                                                   <span class="n">StrRegQ02</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span>
                                                   <span class="n">StrRegQ02</span><span class="p">[</span><span class="s1">&#39;PPIS&#39;</span><span class="p">],</span>
                                                   <span class="n">StrRegQ02</span><span class="p">[</span><span class="s1">&#39;VPIS&#39;</span><span class="p">])</span>

                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrQ02</span>

            <span class="k">if</span> <span class="n">pis_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;99&#39;</span><span class="p">,</span> <span class="s1">&#39;49&#39;</span><span class="p">):</span>
                <span class="n">StrRegQ05</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">pis_cst</span><span class="p">,</span>
                    <span class="s1">&#39;VPIS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_value</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrQ05</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Q05|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">StrRegQ05</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegQ05</span><span class="p">[</span><span class="s1">&#39;VPIS&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrQ05</span>

                <span class="n">StrRegQ07</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_base</span><span class="p">),</span>
                    <span class="s1">&#39;PPIS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_percent</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrQ07</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Q07|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">StrRegQ07</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegQ07</span><span class="p">[</span><span class="s1">&#39;PPIS&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrQ07</span>

            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">pis_percent</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pis_cst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;99&#39;</span><span class="p">,</span> <span class="s1">&#39;49&#39;</span><span class="p">):</span>
                <span class="n">StrQ02</span> <span class="o">=</span> <span class="s1">&#39;Q04|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pis_cst</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrQ02</span>

            <span class="n">StrQ</span> <span class="o">=</span> <span class="s1">&#39;S|</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrQ</span>

            <span class="k">if</span> <span class="n">cofins_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;02&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_percent</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">StrRegS02</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">cofins_cst</span><span class="p">,</span>
                    <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_base</span><span class="p">),</span>
                    <span class="s1">&#39;PCOFINS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_percent</span><span class="p">),</span>
                    <span class="s1">&#39;VCOFINS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_value</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrS02</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;S02|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegS02</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegS02</span><span class="p">[</span>
                    <span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegS02</span><span class="p">[</span><span class="s1">&#39;PCOFINS&#39;</span><span class="p">],</span> <span class="n">StrRegS02</span><span class="p">[</span><span class="s1">&#39;VCOFINS&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrS02</span>

            <span class="k">if</span> <span class="n">cofins_cst</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;99&#39;</span><span class="p">,</span> <span class="s1">&#39;49&#39;</span><span class="p">):</span>
                <span class="n">StrRegS05</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="n">cofins_cst</span><span class="p">,</span>
                    <span class="s1">&#39;VCOFINS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_value</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrS05</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;S05|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">StrRegS05</span><span class="p">[</span><span class="s1">&#39;CST&#39;</span><span class="p">],</span> <span class="n">StrRegS05</span><span class="p">[</span><span class="s1">&#39;VCOFINS&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrS05</span>

                <span class="n">StrRegS07</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;VBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_base</span><span class="p">),</span>
                    <span class="s1">&#39;PCOFINS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_percent</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrS07</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;S07|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">StrRegS07</span><span class="p">[</span><span class="s1">&#39;VBC&#39;</span><span class="p">],</span> <span class="n">StrRegS07</span><span class="p">[</span><span class="s1">&#39;PCOFINS&#39;</span><span class="p">])</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrS07</span>

            <span class="k">if</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">cofins_percent</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cofins_cst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;99&#39;</span><span class="p">,</span> <span class="s1">&#39;49&#39;</span><span class="p">):</span>
                <span class="n">StrS04</span> <span class="o">=</span> <span class="s1">&#39;S04|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cofins_cst</span>
                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrS04</span>

        <span class="n">StrW</span> <span class="o">=</span> <span class="s1">&#39;W|</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrW</span>

        <span class="n">StrRegW02</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vBC&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">icms_base</span><span class="p">),</span>
            <span class="s1">&#39;vICMS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">icms_value</span><span class="p">),</span>
            <span class="s1">&#39;vBCST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">),</span>
            <span class="s1">&#39;vST&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">),</span>
            <span class="s1">&#39;vProd&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">amount_gross</span><span class="p">),</span>
            <span class="s1">&#39;vFrete&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">amount_freight</span><span class="p">),</span>
            <span class="s1">&#39;vSeg&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">amount_insurance</span><span class="p">),</span>
            <span class="s1">&#39;vDesc&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">amount_discount</span><span class="p">),</span>
            <span class="s1">&#39;vII&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">ii_value</span><span class="p">),</span>
            <span class="s1">&#39;vIPI&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">ipi_value</span><span class="p">),</span>
            <span class="s1">&#39;vPIS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">pis_value</span><span class="p">),</span>
            <span class="s1">&#39;vCOFINS&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">cofins_value</span><span class="p">),</span>
            <span class="s1">&#39;vOutro&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">amount_costs</span><span class="p">),</span>
            <span class="s1">&#39;vNF&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">amount_total</span><span class="p">),</span>
            <span class="s1">&#39;vTotTrib&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">amount_total_taxes</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">StrW02</span> <span class="o">=</span> <span class="s1">&#39;W02|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vBC&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vICMS&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vBCST&#39;</span><span class="p">],</span>
            <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vST&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vProd&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vFrete&#39;</span><span class="p">],</span>
            <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vSeg&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vDesc&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vII&#39;</span><span class="p">],</span>
            <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vIPI&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vPIS&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vCOFINS&#39;</span><span class="p">],</span>
            <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vOutro&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vNF&#39;</span><span class="p">],</span> <span class="n">StrRegW02</span><span class="p">[</span><span class="s1">&#39;vTotTrib&#39;</span><span class="p">])</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrW02</span>

        <span class="c1"># Modo do Frete:</span>
        <span class="c1"># 0- Por conta do emitente;</span>
        <span class="c1"># 1- Por conta do destinatário/remetente;</span>
        <span class="c1"># 2- Por conta de terceiros; 9- Sem frete (v2.0)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inv</span><span class="o">.</span><span class="n">incoterm</span><span class="p">:</span>
                <span class="n">StrRegX0</span> <span class="o">=</span> <span class="s1">&#39;9&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">StrRegX0</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">incoterm</span><span class="o">.</span><span class="n">freight_responsibility</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">StrRegX0</span> <span class="o">=</span> <span class="s1">&#39;9&#39;</span>

        <span class="n">StrX</span> <span class="o">=</span> <span class="s1">&#39;X|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegX0</span><span class="p">)</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrX</span>

        <span class="n">StrRegX03</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;XNome&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;IE&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;XEnder&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;UF&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;XMun&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">StrX0</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span>
                <span class="n">inv</span><span class="o">.</span><span class="n">carrier_name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="p">:</span>

                <span class="c1"># Endereço da transportadora</span>
                <span class="n">carrier_addr</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">address_get</span><span class="p">(</span>
                    <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="p">[</span><span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
                <span class="n">carrier_addr_default</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span>
                    <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="p">[</span><span class="n">carrier_addr</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">legal_name</span><span class="p">:</span>
                    <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                        <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                        <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">legal_name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XNome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                        <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                        <span class="n">unicode</span><span class="p">(</span><span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">))</span>

                <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;IE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_est</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
                <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XEnder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span>
                    <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span>
                        <span class="n">carrier_addr_default</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                    <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;UF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">carrier_addr_default</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">carrier_addr_default</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="p">:</span>
                    <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XMun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalize</span><span class="p">(</span>
                        <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span>
                            <span class="n">carrier_addr_default</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
                    <span class="n">StrX0</span> <span class="o">=</span> <span class="s1">&#39;X04|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">StrX0</span> <span class="o">=</span> <span class="s1">&#39;X05|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">inv</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">StrX03</span> <span class="o">=</span> <span class="s1">&#39;X03|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XNome&#39;</span><span class="p">],</span> <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;IE&#39;</span><span class="p">],</span> <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XEnder&#39;</span><span class="p">],</span>
            <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;UF&#39;</span><span class="p">],</span> <span class="n">StrRegX03</span><span class="p">[</span><span class="s1">&#39;XMun&#39;</span><span class="p">])</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrX03</span>
        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrX0</span>

        <span class="n">StrRegX18</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Placa&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;UF&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RNTC&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">vehicle_plate</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">StrRegX18</span><span class="p">[</span><span class="s1">&#39;Placa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">vehicle_plate</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
                <span class="n">StrRegX18</span><span class="p">[</span><span class="s1">&#39;UF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">vehicle_state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">vehicle_id</span><span class="p">:</span>
                    <span class="n">StrRegX18</span><span class="p">[</span><span class="s1">&#39;RNTC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">vehicle_id</span><span class="o">.</span><span class="n">rntc_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">StrX18</span> <span class="o">=</span> <span class="s1">&#39;X18|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegX18</span><span class="p">[</span><span class="s1">&#39;Placa&#39;</span><span class="p">],</span> <span class="n">StrRegX18</span><span class="p">[</span>
                                          <span class="s1">&#39;UF&#39;</span><span class="p">],</span> <span class="n">StrRegX18</span><span class="p">[</span><span class="s1">&#39;RNTC&#39;</span><span class="p">])</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrX18</span>

            <span class="n">StrRegX26</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;QVol&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Esp&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Marca&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NVol&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;PesoL&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;PesoB&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">number_of_packages</span><span class="p">:</span>
            <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;QVol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">number_of_packages</span>
            <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;Esp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">kind_of_packages</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;Marca&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">brand_of_packages</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;NVol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">number_of_packages</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;PesoL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">weight_net</span><span class="p">)</span>
            <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;PesoB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">inv</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>

            <span class="n">StrX26</span> <span class="o">=</span> <span class="s1">&#39;X26|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;QVol&#39;</span><span class="p">],</span> <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;Esp&#39;</span><span class="p">],</span> <span class="n">StrRegX26</span><span class="p">[</span>
                    <span class="s1">&#39;Marca&#39;</span><span class="p">],</span> <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;NVol&#39;</span><span class="p">],</span> <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;PesoL&#39;</span><span class="p">],</span>
                <span class="n">StrRegX26</span><span class="p">[</span><span class="s1">&#39;PesoB&#39;</span><span class="p">])</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrX26</span>

        <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">journal_id</span><span class="o">.</span><span class="n">revenue_expense</span><span class="p">:</span>

            <span class="n">StrY</span> <span class="o">=</span> <span class="s1">&#39;Y|</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrY</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inv</span><span class="o">.</span><span class="n">move_line_receivable_id</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">inv</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;out_invoice&#39;</span><span class="p">,</span> <span class="s1">&#39;in_refund&#39;</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">debit</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">credit</span>

                <span class="n">StrRegY07</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;NDup&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;DVenc&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">date_maturity</span> <span class="ow">or</span> <span class="n">inv</span><span class="o">.</span><span class="n">date_due</span> <span class="ow">or</span>
                    <span class="n">inv</span><span class="o">.</span><span class="n">date_invoice</span><span class="p">,</span>
                    <span class="s1">&#39;VDup&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
                        <span class="n">value</span><span class="p">),</span>
                <span class="p">}</span>

                <span class="n">StrY07</span> <span class="o">=</span> <span class="s1">&#39;Y07|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegY07</span><span class="p">[</span><span class="s1">&#39;NDup&#39;</span><span class="p">],</span> <span class="n">StrRegY07</span><span class="p">[</span>
                                              <span class="s1">&#39;DVenc&#39;</span><span class="p">],</span> <span class="n">StrRegY07</span><span class="p">[</span><span class="s1">&#39;VDup&#39;</span><span class="p">])</span>

                <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrY07</span>

        <span class="n">StrRegZ</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;InfAdFisco&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">inv</span><span class="o">.</span><span class="n">fiscal_comment</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
            <span class="s1">&#39;InfCpl&#39;</span><span class="p">:</span> <span class="n">normalize</span><span class="p">(</span>
                <span class="s1">&#39;NFKD&#39;</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">(</span>
                    <span class="n">inv</span><span class="o">.</span><span class="n">comment</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="s1">&#39;ASCII&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">StrZ</span> <span class="o">=</span> <span class="s1">&#39;Z|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">StrRegZ</span><span class="p">[</span><span class="s1">&#39;InfAdFisco&#39;</span><span class="p">],</span> <span class="n">StrRegZ</span><span class="p">[</span><span class="s1">&#39;InfCpl&#39;</span><span class="p">])</span>

        <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrZ</span>

        <span class="k">if</span> <span class="n">UFEmbarq</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">XLocEmbarq</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">StrRegZA</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;UFEmbarq&#39;</span><span class="p">:</span> <span class="n">UFEmbarq</span><span class="p">,</span>
                <span class="s1">&#39;XLocEmbarq&#39;</span><span class="p">:</span> <span class="n">XLocEmbarq</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">StrZA</span> <span class="o">=</span> <span class="s1">&#39;ZA|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">|</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">StrRegZA</span><span class="p">[</span><span class="s1">&#39;UFEmbarq&#39;</span><span class="p">],</span> <span class="n">StrRegZA</span><span class="p">[</span><span class="s1">&#39;XLocEmbarq&#39;</span><span class="p">])</span>
            <span class="n">StrFile</span> <span class="o">+=</span> <span class="n">StrZA</span>

        <span class="n">documents</span> <span class="o">=</span> <span class="n">inv</span><span class="o">.</span><span class="n">internal_number</span>

        <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;account.invoice&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="p">[</span><span class="n">inv</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;nfe_export_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()})</span>

    <span class="n">nfes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">documents</span><span class="p">,</span> <span class="s1">&#39;nfe&#39;</span><span class="p">:</span> <span class="n">StrFile</span><span class="p">,</span>
                 <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">nfes</span></div>
    <span class="c1"># return unicode(StrFile.encode(&#39;utf-8&#39;), errors=&#39;replace&#39;)</span>


<div class="viewcode-block" id="nfe_import"><a class="viewcode-back" href="../../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.serializer.html#l10n_br_account_product.sped.nfe.serializer.txt.nfe_import">[documentos]</a><span class="k">def</span> <span class="nf">nfe_import</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">pass</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2016, Odoo Community Association (OCA).<br/>
      Criado usando <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>