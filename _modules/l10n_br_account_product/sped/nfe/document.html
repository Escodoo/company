
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="pt_BR">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>l10n_br_account_product.sped.nfe.document &#8212; documentação Odoo Brazil 8.0.0.0</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.3.6/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/oca.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '8.0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/translations.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Índice" href="../../../../genindex.html" />
    <link rel="search" title="Buscar" href="../../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../index.html"><span><img src="../../../../_static/brazil.png"></span>
          Odoo Brazil</a>
        <span class="navbar-text navbar-version pull-left"><b>8.0.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Código fonte para l10n_br_account_product.sped.nfe.document</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Copyright (C) 2013  Renato Lima - Akretion</span>
<span class="c1"># License AGPL-3 - See http://www.gnu.org/licenses/agpl-3.0.html</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">openerp</span> <span class="k">import</span> <span class="n">pooler</span>
<span class="kn">from</span> <span class="nn">openerp.exceptions</span> <span class="k">import</span> <span class="ne">Warning</span> <span class="k">as</span> <span class="n">UserError</span>
<span class="kn">from</span> <span class="nn">openerp.tools.translate</span> <span class="k">import</span> <span class="n">_</span>

<span class="kn">from</span> <span class="nn">openerp.addons.l10n_br_account.sped.document</span> <span class="k">import</span> <span class="n">FiscalDocument</span>
<span class="kn">from</span> <span class="nn">openerp.addons.l10n_br_base.tools.misc</span> <span class="k">import</span> <span class="n">punctuation_rm</span>


<div class="viewcode-block" id="NFe200"><a class="viewcode-back" href="../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.html#l10n_br_account_product.sped.nfe.document.NFe200">[documentos]</a><span class="k">class</span> <span class="nc">NFe200</span><span class="p">(</span><span class="n">FiscalDocument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NFe200</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dup</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">pool</span> <span class="o">=</span> <span class="n">pooler</span><span class="o">.</span><span class="n">get_pool</span><span class="p">(</span><span class="n">cr</span><span class="o">.</span><span class="n">dbname</span><span class="p">)</span>
        <span class="n">nfes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;pt_BR&#39;</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;account.invoice&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span>
                                                          <span class="n">context</span><span class="p">):</span>

            <span class="n">company</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span>
                <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_NFe</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_nfe_identification</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_in_out_adress</span><span class="p">(</span><span class="n">invoice</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">inv_related</span> <span class="ow">in</span> <span class="n">invoice</span><span class="o">.</span><span class="n">fiscal_document_related_ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_NFRef</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nfe_references</span><span class="p">(</span><span class="n">inv_related</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">NFref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_emmiter</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_receiver</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">inv_line</span> <span class="ow">in</span> <span class="n">invoice</span><span class="o">.</span><span class="n">invoice_line</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_Det</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_details</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span> <span class="n">inv_line</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">inv_di</span> <span class="ow">in</span> <span class="n">inv_line</span><span class="o">.</span><span class="n">import_declaration_ids</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">di</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_DI</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_di</span><span class="p">(</span><span class="n">inv_di</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">inv_di_line</span> <span class="ow">in</span> <span class="n">inv_di</span><span class="o">.</span><span class="n">line_ids</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">di_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_Addition</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_addition</span><span class="p">(</span><span class="n">inv_di_line</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">adi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">di_line</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">DI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">journal_id</span><span class="o">.</span><span class="n">revenue_expense</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">move_line</span> <span class="ow">in</span> <span class="n">invoice</span><span class="o">.</span><span class="n">move_line_receivable_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_Dup</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_encashment_data</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span> <span class="n">move_line</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">cobr</span><span class="o">.</span><span class="n">dup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dup</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_carrier_data</span><span class="p">(</span><span class="n">invoice</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_Vol</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_weight_data</span><span class="p">(</span><span class="n">invoice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_additional_information</span><span class="p">(</span><span class="n">invoice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total</span><span class="p">(</span><span class="n">invoice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export</span><span class="p">(</span><span class="n">invoice</span><span class="p">)</span>

            <span class="c1"># Gera Chave da NFe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">gera_nova_chave</span><span class="p">()</span>
            <span class="n">nfes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nfes</span>

    <span class="k">def</span> <span class="nf">_nfe_identification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">):</span>

        <span class="c1"># Identificação da NF-e</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">cUF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span><span class="n">company</span><span class="o">.</span><span class="n">state_id</span> <span class="ow">and</span>
                                         <span class="n">company</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">cNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">natOp</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">fiscal_category_id</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">indPag</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span><span class="n">invoice</span><span class="o">.</span><span class="n">payment_term</span> <span class="ow">and</span>
                                            <span class="n">invoice</span><span class="o">.</span><span class="n">payment_term</span><span class="o">.</span><span class="n">indPag</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">serie</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">document_serie_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">nNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">internal_number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">dEmi</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">date_invoice</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">dSaiEnt</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">date_in_out</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">cMunFG</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">company</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span> <span class="n">company</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">tpImp</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># (1 - Retrato; 2 - Paisagem)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">tpEmis</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">tpAmb</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">nfe_environment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">finNFe</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">nfe_purpose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">procEmi</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">verProc</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;Odoo Brasil v8&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">compra</span><span class="o">.</span><span class="n">xPed</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">cfop_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">tpNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">tpNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_in_out_adress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">):</span>

        <span class="c1">#</span>
        <span class="c1"># Endereço de Entrega ou Retirada</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">tpNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">xLgr</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">nro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">xCpl</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">street2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">xBairro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">district</span> <span class="ow">or</span> <span class="s1">&#39;Sem Bairro&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">cMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">xMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">retirada</span><span class="o">.</span><span class="n">UF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">xLgr</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">nro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">xCpl</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">street2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">xBairro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">district</span> <span class="ow">or</span> <span class="s1">&#39;Sem Bairro&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">cMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">xMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">entrega</span><span class="o">.</span><span class="n">UF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_shipping_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_nfe_references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inv_related</span><span class="p">):</span>

        <span class="c1">#</span>
        <span class="c1"># Documentos referenciadas</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;nf&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNF</span><span class="o">.</span><span class="n">cUF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span> <span class="ow">and</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNF</span><span class="o">.</span><span class="n">AAMM</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNF</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv_related</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNF</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span> <span class="ow">and</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNF</span><span class="o">.</span><span class="n">serie</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">serie</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNF</span><span class="o">.</span><span class="n">nNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">internal_number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;nfrural&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">cUF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span> <span class="ow">and</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">AAMM</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">IE</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">inv_related</span><span class="o">.</span><span class="n">inscr_est</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span> <span class="ow">and</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">serie</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">serie</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">nNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">internal_number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">cpfcnpj_type</span> <span class="o">==</span> <span class="s1">&#39;cnpj&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                    <span class="n">inv_related</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFP</span><span class="o">.</span><span class="n">CPF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                    <span class="n">inv_related</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;nfe&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refNFe</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">access_key</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;cte&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refCTe</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">access_key</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">document_type</span> <span class="o">==</span> <span class="s1">&#39;cf&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refECF</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span> <span class="ow">and</span>
                <span class="n">inv_related</span><span class="o">.</span><span class="n">fiscal_document_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refECF</span><span class="o">.</span><span class="n">nECF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">internal_number</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfref</span><span class="o">.</span><span class="n">refECF</span><span class="o">.</span><span class="n">nCOO</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">inv_related</span><span class="o">.</span><span class="n">serie</span>

    <span class="k">def</span> <span class="nf">_emmiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emitente&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">xNome</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">legal_name</span><span class="p">[:</span><span class="mi">60</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">xFant</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">xLgr</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">company</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">nro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">company</span><span class="o">.</span><span class="n">number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">xCpl</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">company</span><span class="o">.</span><span class="n">street2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">xBairro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">company</span><span class="o">.</span><span class="n">district</span> <span class="ow">or</span> <span class="s1">&#39;Sem Bairro&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">cMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">company</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span> <span class="n">company</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">xMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">company</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">UF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">company</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">CEP</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">company</span><span class="o">.</span><span class="n">zip</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">cPais</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">company</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">bc_code</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">xPais</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">company</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">enderEmit</span><span class="o">.</span><span class="n">fone</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">company</span><span class="o">.</span><span class="n">phone</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">IE</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_est</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">IEST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">IM</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_mun</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">CRT</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">fiscal_type</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_mun</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">emit</span><span class="o">.</span><span class="n">CNAE</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">cnae_main_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_receiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Destinatário&quot;&quot;&quot;</span>

        <span class="n">partner_bc_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">address_invoice_state_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">address_invoice_city</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">partner_cep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">bc_code</span><span class="p">:</span>
            <span class="n">partner_bc_code</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">bc_code</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> \
                <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="n">address_invoice_state_code</span> <span class="o">=</span> <span class="s1">&#39;EX&#39;</span>
            <span class="n">address_invoice_city</span> <span class="o">=</span> <span class="s1">&#39;Exterior&#39;</span>
            <span class="n">address_invoice_city_code</span> <span class="o">=</span> <span class="s1">&#39;9999999&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">address_invoice_state_code</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span>
            <span class="n">address_invoice_city</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">address_invoice_city_code</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)</span>
            <span class="n">partner_cep</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span><span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">zip</span><span class="p">)</span>

        <span class="c1"># Se o ambiente for de teste deve ser</span>
        <span class="c1"># escrito na razão do destinatário</span>
        <span class="k">if</span> <span class="n">nfe_environment</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">xNome</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;NF-E EMITIDA EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">xNome</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">legal_name</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">IE</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                    <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_est</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> \
                    <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">CPF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">indIEDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> \
            <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">partner_fiscal_type_id</span><span class="o">.</span><span class="n">ind_ie_dest</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">xLgr</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">nro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">number</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">xCpl</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">street2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">xBairro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">district</span> <span class="ow">or</span> <span class="s1">&#39;Sem Bairro&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">cMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">address_invoice_city_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">xMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">address_invoice_city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">UF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">address_invoice_state_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">CEP</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">partner_cep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">cPais</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">partner_bc_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">xPais</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">enderDest</span><span class="o">.</span><span class="n">fone</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">phone</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">email</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">,</span> <span class="n">invoice_line</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detalhe&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">nItem</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">index</span>

        <span class="k">if</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">cProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">cEAN</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">ean13</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">cEANTrib</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">ean13</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">xProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">120</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">cProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">xProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">120</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">NCM</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">invoice_line</span><span class="o">.</span><span class="n">fiscal_classification_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="mi">8</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">EXTIPI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">invoice_line</span><span class="o">.</span><span class="n">fiscal_classification_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">8</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">nFCI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">fci</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">CFOP</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cfop_id</span><span class="o">.</span><span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">uCom</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">uos_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">qCom</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">quantity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vUnCom</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.7f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">price_unit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">price_gross</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">uTrib</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">uCom</span><span class="o">.</span><span class="n">valor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">qTrib</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">qCom</span><span class="o">.</span><span class="n">valor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vUnTrib</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vUnCom</span><span class="o">.</span><span class="n">valor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vFrete</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">freight_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vSeg</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">insurance_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vDesc</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">discount_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">vOutro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">other_costs_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">xPed</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">partner_order</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">nItemPed</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">partner_order_line</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">infAdProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">fiscal_comment</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="c1">#</span>
        <span class="c1"># Produto entra no total da NF-e</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">indTot</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_type</span> <span class="o">==</span> <span class="s1">&#39;product&#39;</span><span class="p">:</span>
            <span class="c1"># ICMS</span>
            <span class="k">if</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_cst_id</span><span class="o">.</span><span class="n">code</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">CSOSN</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_cst_id</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">pCredSN</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">vCredICMSSN</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">orig</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_origin</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">CST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_cst_id</span><span class="o">.</span><span class="n">code</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">modBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_base_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_base</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">pRedBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_percent_reduction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">pICMS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">vICMS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">motDesICMS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_relief_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="c1"># ICMS ST</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">modBCST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_st_base_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">pMVAST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_st_mva</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">pRedBCST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_st_percent_reduction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">vBCST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">pICMSST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_st_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMS</span><span class="o">.</span><span class="n">vICMSST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">)</span>

            <span class="c1"># Informação do ICMS Interestadual nas vendas para consumidor final</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">vBCUFDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_dest_base</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">pFCPUFDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_fcp_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">pICMSUFDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_dest_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">pICMSInter</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_origin_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">pICMSInterPart</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_part_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">vFCPUFDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_fcp_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">vICMSUFDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_dest_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ICMSUFDest</span><span class="o">.</span><span class="n">vICMSUFRemet</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">icms_origin_value</span><span class="p">)</span>
            <span class="c1"># IPI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">IPI</span><span class="o">.</span><span class="n">CST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_cst_id</span><span class="o">.</span><span class="n">code</span>
            <span class="k">if</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_type</span> <span class="o">==</span> <span class="s1">&#39;percent&#39;</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">IPI</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_base</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">IPI</span><span class="o">.</span><span class="n">pIPI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_percent</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_type</span> <span class="o">==</span> <span class="s1">&#39;quantity&#39;</span><span class="p">:</span>
                <span class="n">pesol</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_id</span><span class="p">:</span>
                    <span class="n">pesol</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">product_id</span><span class="o">.</span><span class="n">weight_net</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">IPI</span><span class="o">.</span><span class="n">qUnid</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">pesol</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">IPI</span><span class="o">.</span><span class="n">vUnid</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">IPI</span><span class="o">.</span><span class="n">vIPI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">IPI</span><span class="o">.</span><span class="n">cEnq</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">invoice_line</span><span class="o">.</span><span class="n">ipi_guideline_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;999&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ISSQN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ISSQN</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">issqn_base</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ISSQN</span><span class="o">.</span><span class="n">vAliq</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">issqn_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ISSQN</span><span class="o">.</span><span class="n">vISSQN</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">issqn_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ISSQN</span><span class="o">.</span><span class="n">cMunFG</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">,</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">ibge_code</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ISSQN</span><span class="o">.</span><span class="n">cListServ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">invoice_line</span><span class="o">.</span><span class="n">service_type_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">ISSQN</span><span class="o">.</span><span class="n">cSitTrib</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">issqn_type</span>

        <span class="c1"># PIS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PIS</span><span class="o">.</span><span class="n">CST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">pis_cst_id</span><span class="o">.</span><span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PIS</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">pis_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PIS</span><span class="o">.</span><span class="n">pPIS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">pis_percent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PIS</span><span class="o">.</span><span class="n">vPIS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">pis_value</span><span class="p">)</span>

        <span class="c1"># PISST</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PISST</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">pis_st_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PISST</span><span class="o">.</span><span class="n">pPIS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">pis_st_percent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PISST</span><span class="o">.</span><span class="n">qBCProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PISST</span><span class="o">.</span><span class="n">vAliqProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">PISST</span><span class="o">.</span><span class="n">vPIS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">pis_st_value</span><span class="p">)</span>

        <span class="c1"># COFINS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINS</span><span class="o">.</span><span class="n">CST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cofins_cst_id</span><span class="o">.</span><span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINS</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cofins_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINS</span><span class="o">.</span><span class="n">pCOFINS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cofins_percent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINS</span><span class="o">.</span><span class="n">vCOFINS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cofins_value</span><span class="p">)</span>

        <span class="c1"># COFINSST</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINSST</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cofins_st_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINSST</span><span class="o">.</span><span class="n">pCOFINS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cofins_st_percent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINSST</span><span class="o">.</span><span class="n">qBCProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINSST</span><span class="o">.</span><span class="n">vAliqProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">COFINSST</span><span class="o">.</span><span class="n">vCOFINS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">cofins_st_value</span><span class="p">)</span>

        <span class="c1"># II</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">II</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ii_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">II</span><span class="o">.</span><span class="n">vDespAdu</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ii_customhouse_charges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">II</span><span class="o">.</span><span class="n">vII</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ii_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">II</span><span class="o">.</span><span class="n">vIOF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">ii_iof</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">det</span><span class="o">.</span><span class="n">imposto</span><span class="o">.</span><span class="n">vTotTrib</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line</span><span class="o">.</span><span class="n">total_taxes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_di</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice_line_di</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">nDI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">dDI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">date_registration</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">xLocDesemb</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">UFDesemb</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">dDesemb</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">date_release</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">cExportador</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">exporting_code</span>

    <span class="k">def</span> <span class="nf">_addition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice_line_di</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di_line</span><span class="o">.</span><span class="n">nAdicao</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di_line</span><span class="o">.</span><span class="n">nSeqAdic</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di_line</span><span class="o">.</span><span class="n">cFabricante</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">manufacturer_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di_line</span><span class="o">.</span><span class="n">vDescDI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">amount_discount</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encashment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">,</span> <span class="n">move_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dados de Cobrança&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;out_invoice&#39;</span><span class="p">,</span> <span class="s1">&#39;in_refund&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">move_line</span><span class="o">.</span><span class="n">debit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">move_line</span><span class="o">.</span><span class="n">credit</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dup</span><span class="o">.</span><span class="n">nDup</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">move_line</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dup</span><span class="o">.</span><span class="n">dVenc</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span><span class="n">move_line</span><span class="o">.</span><span class="n">date_maturity</span> <span class="ow">or</span>
                                <span class="n">invoice</span><span class="o">.</span><span class="n">date_due</span> <span class="ow">or</span>
                                <span class="n">invoice</span><span class="o">.</span><span class="n">date_invoice</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dup</span><span class="o">.</span><span class="n">vDup</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_carrier_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dados da Transportadora e veiculo&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">modFrete</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">incoterm</span> <span class="ow">and</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">incoterm</span><span class="o">.</span><span class="n">freight_responsibility</span> <span class="ow">or</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">transporta</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> \
                    <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">transporta</span><span class="o">.</span><span class="n">CPF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> \
                    <span class="n">punctuation_rm</span><span class="p">(</span>
                        <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">transporta</span><span class="o">.</span><span class="n">xNome</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">legal_name</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">transporta</span><span class="o">.</span><span class="n">IE</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">inscr_est</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">transporta</span><span class="o">.</span><span class="n">xEnder</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">street</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">transporta</span><span class="o">.</span><span class="n">xMun</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">l10n_br_city_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">transporta</span><span class="o">.</span><span class="n">UF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">carrier_id</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">vehicle_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">veicTransp</span><span class="o">.</span><span class="n">placa</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">vehicle_id</span><span class="o">.</span><span class="n">plate</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">veicTransp</span><span class="o">.</span><span class="n">UF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">vehicle_id</span><span class="o">.</span><span class="n">plate</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">transp</span><span class="o">.</span><span class="n">veicTransp</span><span class="o">.</span><span class="n">RNTC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">vehicle_id</span><span class="o">.</span><span class="n">rntc_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_weight_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Campos do Transporte da NF-e Bloco 381&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">qVol</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">number_of_packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">esp</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">kind_of_packages</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">marca</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">brand_of_packages</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">nVol</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">notation_of_packages</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">pesoL</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">weight_net</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">pesoB</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_additional_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Informações adicionais&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">infAdic</span><span class="o">.</span><span class="n">infAdFisco</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">fiscal_comment</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">infAdic</span><span class="o">.</span><span class="n">infCpl</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">comment</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_total</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Totais&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vBC</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">icms_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vICMS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">icms_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vFCPUFDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">icms_fcp_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vICMSUFDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">icms_dest_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vICMSUFRemet</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">icms_origin_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vBCST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">icms_st_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vST</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">icms_st_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vProd</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">amount_gross</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vFrete</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">amount_freight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vSeg</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">amount_insurance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vDesc</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">amount_discount</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vII</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">ii_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vIPI</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">ipi_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vPIS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">pis_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vCOFINS</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">cofins_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vOutro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">amount_costs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vNF</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">amount_total</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">ICMSTot</span><span class="o">.</span><span class="n">vTotTrib</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice</span><span class="o">.</span><span class="n">amount_total_taxes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">):</span>
        <span class="s2">&quot;Informações de exportação&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">exporta</span><span class="o">.</span><span class="n">UFEmbarq</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">shipping_state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">exporta</span><span class="o">.</span><span class="n">xLocEmbarq</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">shipping_location</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="NFe200.get_NFe"><a class="viewcode-back" href="../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.html#l10n_br_account_product.sped.nfe.document.NFe200.get_NFe">[documentos]</a>    <span class="k">def</span> <span class="nf">get_NFe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">NFe_200</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">NFe_200</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_get_NFRef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">NFRef_200</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">NFRef_200</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_Det</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">Det_200</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Det_200</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_DI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">DI_200</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">DI_200</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_Addition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">Adi_200</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Adi_200</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_Vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">Vol_200</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Vol_200</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_Dup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">Dup_200</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Dup_200</span><span class="p">()</span>

<div class="viewcode-block" id="NFe200.get_xml"><a class="viewcode-back" href="../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.html#l10n_br_account_product.sped.nfe.document.NFe200.get_xml">[documentos]</a>    <span class="k">def</span> <span class="nf">get_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nfe</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serializer</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">valor</span><span class="p">,</span> <span class="s1">&#39;nfe&#39;</span><span class="p">:</span> <span class="n">nfe</span><span class="o">.</span><span class="n">get_xml</span><span class="p">()})</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="NFe200.set_xml"><a class="viewcode-back" href="../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.html#l10n_br_account_product.sped.nfe.document.NFe200.set_xml">[documentos]</a>    <span class="k">def</span> <span class="nf">set_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nfe_string</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">nfe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_NFe</span><span class="p">()</span>
        <span class="n">nfe</span><span class="o">.</span><span class="n">set_xml</span><span class="p">(</span><span class="n">nfe_string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nfe</span></div></div>


<div class="viewcode-block" id="NFe310"><a class="viewcode-back" href="../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.html#l10n_br_account_product.sped.nfe.document.NFe310">[documentos]</a><span class="k">class</span> <span class="nc">NFe310</span><span class="p">(</span><span class="n">NFe200</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NFe310</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_nfe_identification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">NFe310</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_nfe_identification</span><span class="p">(</span>
            <span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">idDest</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">fiscal_position</span><span class="o">.</span><span class="n">cfop_id</span><span class="o">.</span><span class="n">id_dest</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">indFinal</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">ind_final</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">indPres</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">ind_pres</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">dhEmi</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">date_hour_invoice</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">dhSaiEnt</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">date_in_out</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aut_xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_AutXML</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aut_xml</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">accountant_cnpj_cpf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">autXML</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aut_xml</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_receiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NFe310</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_receiver</span><span class="p">(</span>
            <span class="n">invoice</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">nfe_environment</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> \
                <span class="n">invoice</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">country_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">idEstrangeiro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">punctuation_rm</span><span class="p">(</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">cnpj_cpf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_di</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice_line_di</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NFe310</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_di</span><span class="p">(</span><span class="n">invoice_line_di</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">tpViaTransp</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">type_transportation</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">vAFRMM</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">afrmm_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">tpIntermedio</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">type_import</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">CNPJ</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">exporting_code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">UFTerceiro</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice_line_di</span><span class="o">.</span><span class="n">thirdparty_state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invoice</span><span class="p">):</span>
        <span class="s2">&quot;Informações de exportação&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">exporta</span><span class="o">.</span><span class="n">UFSaidaPais</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">shipping_state_id</span><span class="o">.</span><span class="n">code</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">exporta</span><span class="o">.</span><span class="n">xLocExporta</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">shipping_location</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfe</span><span class="o">.</span><span class="n">infNFe</span><span class="o">.</span><span class="n">exporta</span><span class="o">.</span><span class="n">xLocDespacho</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">expedition_location</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="NFe310.get_NFe"><a class="viewcode-back" href="../../../../addons/l10n_br_account_product_service/l10n_br_account_product.sped.nfe.html#l10n_br_account_product.sped.nfe.document.NFe310.get_NFe">[documentos]</a>    <span class="k">def</span> <span class="nf">get_NFe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">NFe_310</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">NFe_310</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_get_NFRef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">NFRef_310</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">NFRef_310</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_Det</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">Det_310</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Det_310</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_Dup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">Dup_310</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Dup_310</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_DI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">DI_310</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">DI_310</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_AutXML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pysped.nfe.leiaute</span> <span class="k">import</span> <span class="n">AutXML_310</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s1">u&#39;Erro!&#39;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s2">u&quot;Biblioteca PySPED não instalada!&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">AutXML_310</span><span class="p">()</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2016, Odoo Community Association (OCA).<br/>
      Criado usando <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>